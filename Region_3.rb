# Ruby Document
# Constants
R = 0.461526  #kJ kg-1 K-1
T_c = 647.096 #K
P_c = 22.064  #MPa
Rho_c = 322   #kg m-3

#T input
#p input
#region 3
N = [ 
   0.10658070028513E+01, -0.15732845290239E+02,  0.20944396974307E+02,
  -0.76867707878716E+01,  0.26185947787954E+01, -0.28080781148620E+01,
   0.12053369696517E+01, -0.84566812812502E-02, -0.12654315477714E+01,
  -0.11524407806681E+01,  0.88521043984318E+00, -0.64207765181607E+00,
   0.38493460186671E+00, -0.85214708824206E+00,  0.48972281541877E+01,
  -0.30502617256965E+01,  0.39420536879154E-01,  0.12558408424308E+00,
  -0.27999329698710E+00,  0.13899799569460E+01, -0.20189915023570E+01,
  -0.82147637173963E-02, -0.47596035734923E+00,  0.43984074473500E-01,
  -0.44476435428739E+00,  0.90572070719733E+00,  0.70522450087967E+00,
   0.10770512626332E+00, -0.32913623258954E+00, -0.50871062041158E+00,
  -0.22175400873096E-01,  0.94260751665092E-01,  0.16436278447961E+00,
  -0.13503372241348E-01, -0.14834345352472E-01,  0.57922953628084E-03,
   0.32308904703711E-02,  0.80964802996215E-04, -0.16557679795037E-03,
  -0.44923899061815E-04 ]
J = [0, 0, 1, 2, 7, 10, 12, 23, 2, 6, 15, 17, 0, 2, 6, 7, 22, 26, 0, 2, 4,
  16, 26, 0, 2, 4, 26, 1, 3, 26, 0, 2, 26, 2, 26, 2, 26, 0, 1, 26]
I = [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3,
   4, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 8, 9, 9, 10, 10, 11]

def Region_3(temp,press)
  temp,press = temp.to_f, press.to_f
  Region_2_rho(temp,press)
end

def Region_2_rho(temp,press)
  diff = 1    
  rho_a = 750.0
  tau = temp/T_c
  while diff > 5e-9
    delta = rho_a/Rho_c
    theta_delta = N[0]/delta
    theta_delta_delta = -N[0]/delta**2
      for i in 1..39
        theta_delta += N[i]*I[i]*delta**(I[i]-1)*tau**J[i]
        theta_delta_delta += N[i]*I[i]*(I[i]-1)*delta**(I[i]-2)*tau**J[i]
      end
    f = delta**2*theta_delta*(R*temp*Rho_c)-press
    df = (R*temp*Rho_c)*(2*delta*theta_delta+delta**2*theta_delta_delta)
    rho_b = rho_a - f/df
    rho_b = 700 if rho_b < 0
    diff = (rho_b-rho_a).abs/rho_b  
    rho_a = rho_b
    #puts rho_a
  end 
end
Region_2_rho(650,25.5837018)
